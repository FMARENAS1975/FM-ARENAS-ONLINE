<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>FM Arenas - Portal Interactivo</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Roboto', sans-serif;
      background: #f0f2f5;
      margin: 0;
      padding: 0;
      color: #333;
    }
    header {
      background: #1877f2;
      color: white;
      padding: 25px;
      text-align: center;
      font-size: 2.2em;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    }
    #controls {
      max-width: 900px;
      margin: 20px auto;
      display: flex;
      justify-content: space-between;
      flex-wrap: wrap;
      padding: 0 15px;
    }
    #controls input, #controls select {
      padding: 8px 12px;
      font-size: 1em;
      margin-bottom: 10px;
      border-radius: 5px;
      border: 1px solid #ccc;
      flex: 1 1 45%;
    }
    #fb-feed {
      max-width: 900px;
      margin: 20px auto;
      padding: 0 15px;
    }
    .post {
      background: white;
      margin-bottom: 30px;
      padding: 20px;
      border-radius: 15px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      opacity: 0;
      transform: translateY(20px);
      transition: all 0.6s ease;
    }
    .post.visible { opacity: 1; transform: translateY(0); }
    .post.text-post { background: #e0e0e0; border-left: 5px solid #999; }
    .post.photo-post { border-left: 5px solid #4CAF50; }
    .post.video-post { border-left: 5px solid #2196F3; }
    .post img, .post video { max-width: 100%; border-radius: 10px; margin-top: 15px; display: block; }
    .carousel { position: relative; overflow: hidden; border-radius: 10px; margin-top: 15px; }
    .carousel img { width: 100%; display: none; }
    .carousel img.active { display: block; }
    .post a { text-decoration: none; color: #1877f2; font-weight: 700; }
    .post small { display: block; margin-top: 10px; color: #555; font-size: 0.9em; }
    .share-buttons { margin-top: 10px; }
    .share-buttons a {
      margin-right: 10px; text-decoration: none; color: white; padding: 6px 12px;
      border-radius: 5px; font-size: 0.9em; font-weight: bold;
    }
    .facebook-share { background: #1877f2; }
    .whatsapp-share { background: #25D366; }
    @media (max-width: 600px) {
      header { font-size: 1.8em; }
      #controls { flex-direction: column; }
      #controls input, #controls select { flex: 1 1 100%; }
      .post { padding: 15px; }
    }
  </style>
</head>
<body>
  <header>FM Arenas - Portal Interactivo</header>

  <div id="controls">
    <input type="text" id="searchInput" placeholder="Buscar palabras clave...">
    <select id="filterSelect">
      <option value="all">Todos los tipos</option>
      <option value="text-post">Solo Texto</option>
      <option value="photo-post">Solo Fotos</option>
      <option value="video-post">Solo Videos</option>
    </select>
  </div>

  <div id="fb-feed">Cargando publicaciones...</div>

  <script>
    const PAGE_ID = "100092439705105"; // ID de tu pÃ¡gina
    const TOKEN = "TU_ACCESS_TOKEN_AQUI"; // Reemplazar con tu Page Access Token
    let allPosts = [];

    function renderPosts(posts) {
      const feed = document.getElementById('fb-feed');
      feed.innerHTML = "";
      posts.forEach((post, idx) => {
        const div = document.createElement('div');
        div.className = `post ${post.typeClass}`;
        let content = `<p>${post.message || ''}</p>`;

        if(post.attachmentsHTML) content += post.attachmentsHTML;

        content += `<p><a href="${post.permalink_url}" target="_blank">Ver en Facebook</a></p>`;
        content += `<small>Publicado el ${new Date(post.created_time).toLocaleString()}</small>`;
        content += `
          <div class="share-buttons">
            <a class="facebook-share" href="https://www.facebook.com/sharer/sharer.php?u=${post.permalink_url}" target="_blank">Facebook</a>
            <a class="whatsapp-share" href="https://api.whatsapp.com/send?text=${encodeURIComponent(post.permalink_url)}" target="_blank">WhatsApp</a>
          </div>
        `;
        div.innerHTML = content;
        feed.appendChild(div);

        setTimeout(() => div.classList.add('visible'), idx * 200);
      });

      const carousels = document.querySelectorAll('.carousel');
      carousels.forEach(carousel => {
        let imgs = carousel.querySelectorAll('img');
        let index = 0;
        setInterval(() => {
          imgs[index].classList.remove('active');
          index = (index + 1) % imgs.length;
          imgs[index].classList.add('active');
        }, 4000);
      });
    }

    function filterPosts() {
      const keyword = document.getElementById('searchInput').value.toLowerCase();
      const typeFilter = document.getElementById('filterSelect').value;

      const filtered = allPosts.filter(post => {
        const matchesType = typeFilter === 'all' || post.typeClass === typeFilter;
        const matchesKeyword = post.message && post.message.toLowerCase().includes(keyword);
        return matchesType && matchesKeyword;
      });

      renderPosts(filtered);
    }

    fetch(`https://graph.facebook.com/v21.0/${PAGE_ID}/posts?fields=message,created_time,full_picture,permalink_url,attachments{media,type,subattachments}&access_token=${TOKEN}`)
      .then(res => res.json())
      .then(data => {
        allPosts = data.data.map(post => {
          let typeClass = "text-post";
          let attachmentsHTML = "";

          if(post.attachments && post.attachments.data.length > 0){
            post.attachments.data.forEach(att => {
              if(att.type === "photo") typeClass = "photo-post";
              if(att.type === "video") typeClass = "video-post";

              if(att.type === "photo" && att.media && att.media.image){
                attachmentsHTML += `<img src="${att.media.image.src}" alt="Imagen de publicaciÃ³n">`;
              }
              if(att.type === "video" && att.media && att.media.source){
                attachmentsHTML += `<video controls src="${att.media.source}"></video>`;
              }
              if(att.subattachments && att.subattachments.data.length > 0){
                let carousel = '<div class="carousel">';
                att.subattachments.data.forEach((sub,i) => {
                  carousel += `<img src="${sub.media.image.src}" class="${i===0?'active':''}">`;
                });
                carousel += '</div>';
                attachmentsHTML += carousel;
              }
            });
          }

          return { ...post, typeClass, attachmentsHTML };
        });

        renderPosts(allPosts);
      })
      .catch(err => {
        document.getElementById('fb-feed').innerHTML = "Error cargando publicaciones ðŸ˜¢";
        console.error(err);
      });

    document.getElementById('searchInput').addEventListener('input', filterPosts);
    document.getElementById('filterSelect').addEventListener('change', filterPosts);
  </script>
</body>
</html>
